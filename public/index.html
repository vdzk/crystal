<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>Crystal</title>
	<link rel="stylesheet" href="/css/bootstrap.css">
	<script src="/js/libs/jquery.js"></script>
	<script src="/js/libs/bootstrap.js"></script>
	<script src="/js/libs/underscore.js"></script>
	<script src="/js/libs/backbone.js"></script>
	<script src="/js/libs/backbone.localStorage.js"></script>
</head>
<body>
	<div class="container" id="social-movements">
		<header id="header">
			<h1>Social Movements</h1>
			<form class="form-inline">
				<div class="form-group">
					<input id="new-argument" placeholder="What needs to be done?" class="form-control">
					<input type="button" class="btn btn-primary" id="add-new-argument" value="Start a social movement!">
				</div>
			</form>
		</header>
		<section id="main">
			<div>None so far. Be the first one!</div>
			<ul id="argument-list"></ul>
		</section>
	</div>
	
	<script type="text/template" id="argument-template">
		<div class="view">
			<span>conf.: <%- confidence %></span>
			<label><%- title %></label>
		</div>
	</script>

	<script type="text/javascript">
		var app = {};
		app.Argument = Backbone.Model.extend({
			defaults: {
				title: '',
				confidence: 0
			}
		});
		
		app.ArgumentList = Backbone.Collection.extend({
			model: app.Argument,
			localStorage: new Store("argument-list")
		});
		app.argumentList = new app.ArgumentList();
		
		app.ArgumentView = Backbone.View.extend({
			tagName: 'li',
			template: _.template($('#argument-template').html()),
			render: function(){
				this.$el.html(this.template(this.model.toJSON()));
				return this;
			}
		});
		
		app.AppView = Backbone.View.extend({
			el: '#social-movements',
			initialize: function () {
				this.input = this.$('#new-argument');
				app.argumentList.on('add', this.addOne, this);
				app.argumentList.on('reset', this.addAll, this);
				app.argumentList.fetch();
			},
			events: {
				'click #add-new-argument': 'createArgumentOnBtnClick'
			},
			createArgumentOnBtnClick: function(event) {
				if (!this.input.val().trim()) {
					return false;
				}
				app.argumentList.create(this.newAttributes());
				this.input.val('');
			},
			addOne: function(argument){
				var view = new app.ArgumentView({model: argument});
				$('#argument-list').append(view.render().el);
			},
			addAll: function(){
				this.$('#argument-list').html('');
				app.argumentList.each(this.addOne, this);
			},
			newAttributes: function(){
				return {
					title: this.input.val().trim(),
					confidence: 0
				}
			}
		});
		app.appView = new app.AppView();
	</script>
</body>